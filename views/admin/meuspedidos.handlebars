<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap');
        input
    {
        border-radius: 0.375rem;
    }
    textarea
    {
    border-radius: 0.375rem;
    color: fieldtext;
    letter-spacing: normal;
    word-spacing: normal;
    line-height: normal;
    text-transform: none;
    text-indent: 0px;
    text-shadow: none;
    display: inline-block;
    text-align: start;
    appearance: auto;
    cursor: text;
    margin: 0em;
    padding: 1px 2px;
    border-width: 2px;
    border-style: inset;
    border-color: -internal-light-dark(rgb(118, 118, 118), rgb(133, 133, 133));
    border-image: initial;
    }
    button
    {
        border-radius: 0.375rem;
        transition-duration: 0.4s;
    }
    input#file-upload-button
    {
        border-radius: 0.375rem;
        
    }
            section{
            
            border-radius: 10px;
            padding: 15px;
            min-width: 8rem;
            width: 345px;
            height: auto;
            margin: 0 -2px 15px 10px;
            text-align: left;
            box-shadow: 3px 5px 10px;
            transform: translateY(-1600px);
            opacity: 0;
            float: right;
            }

            #section.animar
            {
                animation-name: slide;
                animation-duration: 1.2s;
                animation-fill-mode: forwards;
            }

            @keyframes slide
            {
                to
                {
                    transform: translateY(0px);
                    opacity: 1;
                }
            }

            .card
            {
            --bs-card-bg: none;
            --bs-card-border-color: rgb(88 88 88);
            margin-top: 15px;
            min-width: 300px;
            position: relative;
           
            }

            #concluir 
            {
              float: right;
              width: 84.09px;
              position: relative;
              font-size: smaller;
            }

            #editar
            {
                float: right;
                width: 84.09px;
                position: relative;

            }

            #apagar
            {
                float: right;
                width: 84.09px;
                color: #dc3545;
                border-color: #dc3545;
                background-color: transparent;
                padding: 0.300rem
                
            }

            #apagar:hover
            {
                color: #fff;
                background-color: #dc3545;
                border-color: #dc3545;
            }
            


            #estado
            {
                color: #ffa601;
                text-decoration: none;
            }
            
            .popup
            {
                display: flex;
                border-radius: 10px;
                font-family: 'Poppins', sans-serif;
                align-items: center;
                text-align: center;
                padding: 15px;
                border-width: 1px;
                justify-content: center;
                width: 100%;
                max-width: 340px;
                background-color: #222;
                margin: 20% auto;
                box-shadow: 3px 5px 10px;
                color: #f4f4f4;
            }
            .btn-popup
            {
                display: flex;
                justify-content: center;
                
            }
            
            .popWrapper
            {
                background: rgba(0, 0, 0, .5);
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: none;
                
            }

            #popApagar
            {
                margin-left: 10px;
            }
            #img_popup
            {
                
                width: 70px;
                
            }

            .pagination
            {
                justify-content: center;
                align-items: center;
                padding: 10px;
                font-family: 'Poppins', sans-serif;
            }

            #next, #prev
            {
                background-color: transparent;
                padding: 0.375rem;
                margin: 5px;
                color: #ffa601;
                border:#ffa601 solid 1px;
                transition: 0.4s;
            }

            #next:hover, #prev:hover
            {
                background-color: #ffa601;
                color: #f4f4f4;

            }

            .btnPopup
            {
                display: none;
            }

            .select
            {
                float: right;
                display: flex;
                flex-direction: column;
                font-size: 11px;
                font-family: 'Poppins', sans-serif;
                
            }

            .delSelect
            {
                border-radius: 0.375rem;

            }

                
</style>







<article class="content">
<h2>Lista de pedidos</h2><button id="anim" class="btn btn-outline-success">Novo pedido</button>
<hr>

{{#each erros}}
<div class="alert alert-danger">{{texto}}</div>
{{else}}

{{/each}}



<section id="section" >
<h2>Novo pedido</h2>
<hr>

<form action="/admin/pedidos/novo" method="post" enctype="multipart/form-data">

<label for="cliente">Cliente: </label>
<p><input type="text" name="cliente" id="cliente" placeholder="Nome do cliente" required></p>

<label for="pedido">Pedido: </label>
<p><input type="text" name="pedido" id="pedido" placeholder="Nome do pedido" required></p>

<label for="descri">Descrição: </label>
<p><textarea name="descri" id="descri" cols="23" rows="4" placeholder="Descrição do pedido"></textarea></p>

<label for="quant">Quantidade: </label>
    <p><input type="number" name="quant" id="quant" placeholder="Quantidade total" required>
</p>
<p>
    <input accept="image/*" required type="file" name="arquivo" id="arquivo">
</p>
<p>
    <button class="btn btn-outline-danger" id="cancel" >Cancelar</button>
    <button class="btn btn-outline-success" id="fin" type="submit" >Finalizar</button> 
    </form>
</p>

</section>



{{#each pedidos}}

<div class="card" >
    <div class="card-body">
        <h3><strong>Cliente:</strong>  {{cliente}}</h3> 
 
        <p><strong>Pedido:</strong> {{pedido}} 
        
        <form action="/admin/pedidos/concluir" method="post"><button  type="submit" class="btn btn-outline-success" id="concluir">Concluir</button>
        <input type="hidden" name="id" id="id" value="{{_id}}">
        <input type="hidden" name="email" value="{{email}}">
        </form>  
        </p>

 

        <p><strong>Descrição:</strong> {{descri}}</p>
        
      <a href="/admin/pedidos/edit/{{_id}}"><button type="button" class="btn btn-outline-warning" id="editar">Editar</button></a>
        
          <p><strong>Quantidade:</strong> {{quant}} </p>
          <div class="select">
          <strong>Deseja apagar?</strong>
          <select name="delSelect" class="delSelect" >
            <option value="apagar" id="optDel" class="optDel">Sim</option>
            <option value="cancelar" selected>Não</option>
          </select>
          </div>

             <form action="/admin/pedidos/delete" method="post">
             <input type="hidden" name="id" id="id" value="{{_id}}">
             <button   class="btnPopup" id="apagar">Apagar</button></a>
             </form>
        
        
        <p><strong>Arquivo:</strong></p>

        <img class="foto-pedido" src="{{arquivo}}" alt="img_pedido" width="150px">

        <p><strong>Data do pedido:</strong> {{data}}</p>

        <strong>Status: </strong>  <u id="estado" >{{estado}}</u>

    </div>   
</div>

             
{{else}}

{{/each}}
</article>
<div class="pagination">
   <a  id="linkPrev"><button id="prev">Anterior</button></a>
   <a id="linkNext" ><button id="next" >Próxima</button></a> 
</div>

<script>
    var section = document.getElementById('section')
    var anim = document.getElementById('anim')
    var animar = document.getElementsByClassName('animar')
    var cancel = document.getElementById('cancel')
    var fin = document.getElementById('fin')
    var concluir = document.getElementById('concluir')
    var estado = document.getElementById('estado')
    var popup1 = document.getElementById('apagar')
    var popup = document.getElementsByClassName('popWrapper')
    var voltar = document.getElementById('voltar')
    var tdsBtn = document.getElementsByClassName('btnPopup')
    

    anim.addEventListener('click', () =>
    {
        section.classList.toggle('animar')
    })

        cancel.addEventListener('click', () =>
    {
        section.classList.toggle('animar')
    })

    var linkNext = document.getElementById('linkNext')
    
    var string = Number(window.location.href.substr(-1))

    
        
    
    function btnNext()
    {
        
    if(window.location.search == '' || window.location.search == '?page=0')
    {
         linkNext.setAttribute('href', `/admin/pedidos?page=1`)
    }
    else
    {
        linkNext.setAttribute('href', `/admin/pedidos?page=${string + 1}`)
    }
    }

    btnNext()

    var linkPrev = document.getElementById('linkPrev')

    function btnPrev()
    {
        
    if(window.location.search == '' || window.location.search == '?page=0')
    {
         linkPrev.setAttribute('href', `/admin/pedidos?page=0`)
    }
    else
    {
        linkPrev.setAttribute('href', `/admin/pedidos?page=${string - 1}`)
    }
    }

    btnPrev()

    var select = document.querySelectorAll('.delSelect')
    var btnApagar = document.querySelectorAll('.btnPopup')
    var selectDiv = document.querySelectorAll('.select')

    select.forEach((element) =>
    {
        element.addEventListener('change', function btnNone()
        {
            var selecionada = element.options[element.selectedIndex].value
            if(selecionada === "apagar")
            {
                btnApagar.forEach((btn) =>
            {
                btn.style.display = 'block'
            })

            selectDiv.forEach((div) =>
            {
                div.style.display = 'none'
            })

            }
            else
            {
                btnApagar.forEach((btn) =>
            {
                btn.style.display = 'none'
            })
            }
        })
    })

    

    
</script>